<!DOCTYPE html>
<html>
<head>
  <title>Google Merchant Products</title>
  <meta charset='utf-8' />
</head>
<body>
  <h1>Google Merchant Products</h1>

  <!-- Button to authorize and load -->
  <button id="authorize-button">Authorize</button>
  <button id="signout-button" style="display: none;">Sign Out</button>

  <div id="content"></div>

  <!-- Include the Google API Client Library -->
  <script async defer src="https://apis.google.com/js/api.js"></script>
  <script>
    // Enter your Service Account credentials here
    const SERVICE_ACCOUNT_KEY = {
      "type": "service_account",
      "project_id": "totemic-ground-427721-d2",
      "private_key_id": "d6345cf01567eb9a15c6c2214ca496a168e4b65d",
      "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQCWW5ya+yDXZNFd\n2vrVJ+qU+7MLiOkGTFHh7POnj+Skp/LgJ2EInlrH3RdzkDDNrMQ7CYwE3PV995CP\nhJv6cn/Ld1bJSLwv30nDde79cio1EVJNgomhy5YyQeJmsK9ymP2FGt0bvSYIcx83\nNEZPf6lEFeRwWcDuBtnTGkKTeFUxiKcnE7MQeUtHzRg7oNQgggSwM11Ap5MLTHk0\nLc1XoNK2d1fJNEIyvPA5LVFoF0aznKCtMjoy27vvB2570xkfLwL6uICs29oVsdXX\nPzgcCkiYyqUF4/TtxgcP1qQx2Z16+vza9QXQ0EmvjuBMT0u09jq7xjt1B1M/k4ec\n5mD6hMs3AgMBAAECggEAPdiO8Rys5Iw+pjllhXn2vrNNcUgueX25DJIXouvII4ZF\nm7f27MGeG6mwdMNxn5gZ2yLRKkrs25SSLMZiFkE0ma+Lzh2R8qsIv1JqLGviOpPW\nY7V3AUspi6CYDJ9Oe3e8iByFqFxEIaOgymdBKIAdUrkijqgMeJvuyyt5CQmtGUM3\nsokR4vVD7YebyBJfl5v1Q4m4ao08TnIk5miXjZbMe0mfeFAU+BFQVJQcP1RKn9iT\ny+JxELXG8MIyhgYgliA58G4Yofto7iZ0TT9nToNL6nZBR3a3kFsUa69aqMhn4SRk\nNO74TlSYwHLzqCdy31ulvkfzZkRak4kASOU42Ixh0QKBgQDQi43IzNmNe74jfhKI\nMvo6ozsgDlZROjByXuR7Uy/jSJKeDsKjJj9SJ8YeE2TaD4llC1yfX+JHwAEJh5DX\nQLUPkaLs4pdT/1tvGJAI6mF4ohqaZ4pV1noJW73k9c9Wk0bFYz6cxXhu6KOuTRJ/\n3ZIe9ZIUQpBjkD/2aHtbbF4nuQKBgQC4knTALzbfGBomSYs5DupO6bfrQdtvHmEL\nc+dOaCvRfFPKZTwr9T/zxDEIlRt57OSnzbm2ttZlTCPoOT7Xm+94f8pTWtpj+sjB\nU4ly9mnzQ8n6qrvTWaJOzBjDQoG4D7rGh+l9hCGlrlqUec8l8ABWEKj24sV782bx\nJmMCT0MibwKBgCIA/0dkj3yQVrp2zhLDLSXug6+AZvarpEahzmOFduN6a921zmrH\ny79bmORCiUk9C0wchCfAfKbyWbjyD93pQRyexJAXilE56/C7cpDhlq8Sz3+prla8\nt/1apiX1Jq+ZKAr7WbQ6Rp7e9AFxs7iBqle99umyyNRTKvrEooiPrPKRAoGARIMg\n0WH1RVTGCCZOhqyRrx80hSBaGuI09bJdTw5+DXHQDJYNgueziIHwDZaDr3uO2PcV\nk8xEwy9DOOVe/VvFxX3yFYTpAinKMXEX2VO8um8UX3bW57oi9IrwOjLKwg8crqsu\nscfFUaHpv6mDijqPdWMTxSkiU0Njl+o+4FGZwwMCgYBuqtIRjzCbKYfGctR/iktN\nEWQqHmWuZLmMBKaJyhSVPNou/fUV505KW2D4TjCXH9y5KV0Orplzl+SdX4QNgqR6\nl40kfIHbQPxkJG4gESwpeaZ7yUyvxOgkzfGjjVho9/P8a/pajEOXBegt9HBncnT2\n2r3jQZ5UEju2FkWc1dujIQ==\n-----END PRIVATE KEY-----\n",
      "client_email": "google-content-api-test@totemic-ground-427721-d2.iam.gserviceaccount.com",
      "client_id": "106017689506447985319",
      "auth_uri": "https://accounts.google.com/o/oauth2/auth",
      "token_uri": "https://oauth2.googleapis.com/token",
      "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
      "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/google-content-api-test%40totemic-ground-427721-d2.iam.gserviceaccount.com"
    };
    const MERCHANT_ID = "5390490385";
    let accessToken = null;

    // Function to authenticate and load client
    function authenticateAndLoad() {
      gapi.auth.authorize({
        'client_id': SERVICE_ACCOUNT_KEY.client_id,
        'scope': 'https://www.googleapis.com/auth/content',
        'immediate': false,
        'response_type': 'token id_token',
        'login_hint': SERVICE_ACCOUNT_KEY.client_email,
        'fetch_basic_profile': false,
        'approval_prompt': 'force'
      }, function(response) {
        if (response.error) {
          console.error("Error authenticating: ", response.error);
          alert("Error authenticating. Please check console for details.");
        } else {
          accessToken = response.access_token;
          console.log("Authentication successful. Access token:", accessToken);
          loadClient();
        }
      });
    }

    // Function to load Google API client
    function loadClient() {
      gapi.client.setApiKey(SERVICE_ACCOUNT_KEY.private_key);
      gapi.client.load("https://shoppingcontent.googleapis.com/$discovery/rest?version=v2.1")
        .then(() => { 
          console.log("GAPI client loaded for API"); 
        })
        .catch(err => { 
          console.error("Error loading GAPI client for API", err); 
          alert("Error loading GAPI client for API. Please try again later.");
        });
    }

    // Function to list products
    function listProducts() {
      if (!accessToken) {
        console.error("Access token not available. Please authenticate first.");
        return;
      }

      gapi.client.request({
        path: `/content/v2.1/${MERCHANT_ID}/products`,
        method: 'GET',
        headers: {
          Authorization: `Bearer ${accessToken}`
        }
      }).then(response => {
        console.log("Response", response);
        // Handle response here
        document.getElementById('content').innerText = JSON.stringify(response.result);
      }).catch(err => {
        console.error("Error listing products", err);
        alert("Error listing products. Please check console for details.");
      });
    }

    // Initialize button click events
    document.getElementById('authorize-button').addEventListener('click', authenticateAndLoad);
    document.getElementById('list-products-button').addEventListener('click', listProducts);
  </script>
</body>
</html>
